name: openswitch-extreme-x870
version: '1.0.1'
summary: OpenSwitch for the Extreme x870
description: |
  OpenSwitch for the Extreme Networks Summit x870 switch.

grade: devel
confinement: devmode

apps:
  # This command is used to run a quick sanity test on the OPX in order
  # to verify that OPX was installed and started correctly.
  test-opx:
    command: usr/bin/test-opx-hw

  # This command is used to auto-start and auto-stop the OPX services.
  snap-service-helper:
    command: usr/bin/snap-service-helper --debug --env $SNAP/usr/bin/opx-init-env --precmd $SNAP/usr/bin/opx-snap-init start
    daemon: simple
    stop-command: usr/bin/pkill -SIGTERM snap-service-helper
    plugs: [ network, network-control, network-bind, network-setup-observe, network-observe, gsettings, firewall-control, fuse-support, i2c, kernel-module-control, process-control ]

  shell:
    command: bin/bash
    
parts:
  opx-init:
    plugin: make
    source: src/opx-init
    stage-packages: [ redis-server, i2c-tools, binutils, file, strace, bash, iputils-ping, traceroute, python, procps ]
    stage:
      - -etc/redis/redis.conf
  libopx-logging:
    source: ../libopx-logging1_1.0.1_amd64.deb 
    plugin: x_dump
  python-opx-logging:
    source: ../python-opx-logging_1.0.1_amd64.deb 
    plugin: x_dump
  libopx-common-utils:
    source: ../libopx-common1_1.0.1_amd64.deb
    plugin: x_dump
  libopx-cps:
    source: ../libopx-cps1_1.0.1_amd64.deb
    plugin: x_dump
  libopx-pas:
    source: ../libopx-pas1_1.0.1_amd64.deb
    plugin: x_dump
  opx-cps:
    source: ../opx-cps_1.0.1_amd64.deb
    stage-packages: [ libhiredis0.13 ]
    plugin: x_dump
  python-opx-cps:
    source: ../python-opx-cps_1.0.1_amd64.deb
    plugin: x_dump
  libopx-base-model:
    source: ../libopx-base-model1_1.0.1_amd64.deb
    plugin: x_dump
  libopx-sdi-framework:
    source: ../libopx-sdi-framework1_1.0.1_amd64.deb
    plugin: x_dump
  libopx-sdi-device-drivers:
    source: ../libopx-sdi-device-drivers1_1.0.1_amd64.deb
    plugin: x_dump
  libopx-sdi-sys:
    source: ../libopx-sdi-sys1_1.0.1_amd64.deb
    plugin: x_dump
  opx-platform-config:
    source: ../opx-platform-config-extreme-x870_1.0.1_amd64.deb
    plugin: x_dump
    stage-packages: [ dmidecode ]
  opx-pas:
    source: ../opx-pas_1.0.1_amd64.deb
    plugin: x_dump
  opx-tempctl:
    source: ../opx-tmpctl_1.0.1_all.deb
    plugin: x_dump
